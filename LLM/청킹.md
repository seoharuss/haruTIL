문서 청킹

- 큰 문서를 임베딩하기 위해 더 작고 관리 가능한 청크로 나누는 것을 의미
1. 최대 토큰 범위 분할
    1. 주어진 최대 크기 청크로 문서를 나누는 것
    2. 하지만, 텍스트를 주어진 범위로 나눈다면 실수로 중요한 텍스트 일부를 잘라낼 수 있어, 문맥이 분리될 위험이 있음
        1. 해결하는 방법으로 토큰이 청크 사이에 공유되도록 지정된 양의 토큰으로 겹치는 범위를 설정하면 된다.
2. 맞춤형 구분 기호 찾기
    1. 균일하지 않은 청크 크기를 갖게 된다.
    2. 2개의 공백 = 개행문자 → 페이지를 구분하는 방법
3. 클러스터링을 사용하여 의미 기반 문서 생성하기
    1. 의미적으로 유사한 작은 정보 청크를 결합하여 새로운 문서를 생성하는 것을 뜻함
    2. 청크에 대한 어떠한 수정이든 결과로 벡터를 변경한다.
    3. 내용의 일부가 주변 텍스트와 맥락에서 벗어나는 단점이 있음
    4. 이 방법은 청크들이 서로 관련이 없을 때(서로 독립적일 때) 잘 작동한다.
4. 청크로 나누지 않고 전체 문서 사용하기
    1. 문맥 윈도우 한계에 도달하는 경우, 품질이 저하되는 경우 등의 단점이 있음

<aside>
💡 문서 임베딩을 위한 접근 방식을 선택할 때, 청크를 사용하는 것과 전체 문서를 사용하는 것 사이의 장단점을 고려하는 것이 중요하다.
</aside>

| 청킹 유형 | 설명 | 장점 | 단점 |
| --- | --- | --- | --- |
| 최대 토큰 범위 청킹 (중복 없음) | 문서는 고정된 크기의 범위로 나뉘며, 각 범위는 별도의 청크를 나타냄 | 단순하고 구현 쉬움 | 청크 사이의 문맥이 잘려 나가면서 정보 손실 가능성 있음 |
| 최대 토큰 범위 청킹 (중복 있음) | 문서는 고정된 크기의 중복 범위로 나뉨 | 단순하고 구현 쉬움 | 다른 청크 간에 중복된 정보가 발생 가능 |
| 자연 구분자를 기준으로 한 청킹 | 문서의 자연 공백이 각 청크의 경계를 결정하는데 사용됨 | 자연스럽게 끝나는 더 의미 있는 청크를 만들 수 있음 | 적절한 구분 기호를 찾는데 시간이 소요 될 수 있음 |
| 의미 기반 문서 생성을 위한 클러스터링 | 비슷한 청크가 결합되어 더 큰 의미 기반 문서를 형성 | 문서의 전반적인 의미를 포착하는 더 의미 있는 문서를 생성할 수 있음 | 더 많은 컴퓨팅 자원이 필요하고, 구현이 더 복잡할 수 있음 |
| 전체 문서 사용 (청킹 없음) | 전체 문서가 하나의 청크로 취급 | 단순하고 구현 쉬움 | 임베딩을 위한 문맥 윈도우로 인해 문맥이 과도하게 들어가서 임베딩의 품질에 영향을 줄 수 있음  |

- 문서를 청킹할 지 결정하면, 생성한 임베딩을 저장할 곳이 필요하다.
- 로컬에서는 빠른 검색을 위해 행렬 연산에 의존할 수 있다. (클라우드 환경도 가능)